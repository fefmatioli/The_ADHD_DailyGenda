{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The ADHD DailyGenda</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap');
  </style>
</head>
<body>

  <!-- ===== CABEÃ‡ALHO ===== -->
  <header class="header">
    <h1>The ADHD DailyGenda</h1>
    <div class="user-info">
      <p>Welcome, {{ request.user.username }}</p>
      <form action="{% url 'logout' %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="submit-btn">Logout</button>
      </form> 
    </div>
  </header>

  <!-- ===== CONTEÃšDO PRINCIPAL ===== -->
  <main class="main-grid">

    <!-- === CALENDÃRIO === -->
    <section class="card calendar-card">
    <div class="card-header">
        <h2>ğŸ“… Events</h2>
        <button class="add-btn" onclick="toggleForm('event-form')">+</button>
    </div>

    <!-- === Todayâ€™s Events === -->
    <h3 class="event-subtitle">ğŸ•’ Todayâ€™s Events</h3>
    {% if todays_events %}
        <ul class="event-list">
        {% for event in todays_events %}
            <li>
            <a href="{% url 'event_detail' event.id %}" class="event-link">
                <strong>{{ event.title }}</strong>
            </a>
            {% if event.time %}
                <span class="event-time">
                â° {{ event.time }}{% if event.end_time %} â†’ {{ event.end_time }}{% endif %}
                </span>
            {% endif %}
            <form method="post" action="{% url 'delete_event' event.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="delete-btn-text">Delete</button>
            </form>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p class="empty">No events today.</p>
    {% endif %}

    <!-- === This Monthâ€™s Events === -->
    <h3 class="event-subtitle">ğŸ“† This Monthâ€™s Events</h3>
    {% if month_events %}
        <ul class="event-list">
        {% for event in month_events %}
            <li>
                <a href="{% url 'event_detail' event.id %}" class="event-link">
                <strong>{{ event.date|date:"d/m" }} â€” {{ event.title }}</strong>
                </a>
                {% if event.time %}
                <span class="event-time">â° {{ event.time }}{% if event.end_time %} â†’ {{ event.end_time }}{% endif %}</span>
                {% endif %}
                <form method="post" action="{% url 'delete_event' event.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="delete-btn-text">Delete</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p class="empty">No other events this month.</p>
    {% endif %}

    <!-- === Upcoming Events === -->
    <h3 class="event-subtitle">ğŸš€ Upcoming Events</h3>
    {% if future_events %}
        <ul class="event-list">
        {% for event in future_events %}
            <li>
                <a href="{% url 'event_detail' event.id %}" class="event-link">
                <strong>{{ event.date|date:"d/m/Y" }} â€” {{ event.title }}</strong>
                </a>
                {% if event.time %}
                <span class="event-time">â° {{ event.time }}{% if event.end_time %} â†’ {{ event.end_time }}{% endif %}</span>
                {% endif %}
                <form method="post" action="{% url 'delete_event' event.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="delete-btn-text">Delete</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p class="empty">No future events scheduled.</p>
    {% endif %}

    <!-- === FormulÃ¡rio de Novo Evento === -->
    <form id="event-form" class="hidden-form" method="post" action="{% url 'create_event' %}">
        {% csrf_token %}
        {{ event_form.as_p }}
        <button type="submit" class="submit-btn">Save event</button>
    </form>
    </section>

    <!-- === TO DO LIST === -->
    <section class="card todo-card">
      <div class="card-header">
        <h2>ğŸ§¾ To Do List</h2>
        <button class="add-btn" onclick="toggleForm('task-form')">+</button>
      </div>
        {% if tasks %}
            <ul class="task-list">
                {% for task in tasks %}
                <li class="{% if task.done %}done{% endif %}">
                    <form method="post" action="{% url 'toggle_task' task.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="check-btn">âœ”</button>
                    <span>{{ task.title }}</span>
                    </form>
                    <form method="post" action="{% url 'delete_task' task.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn-text">Delete</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p class="empty">Nenhuma tarefa cadastrada.</p>
        {% endif %}
      <form id="task-form" class="hidden-form" method="post" action="{% url 'create_task' %}">
        {% csrf_token %}
        {{ task_form.as_p }}
        <button type="submit" class="submit-btn">Salvar tarefa</button>
      </form>
    </section>

    <!-- === NOTAS === -->
    <section class="card notes-card">
      <div class="card-header">
        <h2>ğŸ“ Notes</h2>
        <button class="add-btn" onclick="toggleForm('note-form')">+</button>
      </div>
        {% if notes %}
            <ul class="note-list">
                {% for note in notes %}
                <li class="note-item">
                    <a href="{% url 'note_detail' note.id %}" class="note-link">
                        <strong>{{ note.title }}</strong>
                        <p>{{ note.content|truncatechars:80 }}</p>
                    </a>
                    <span class="tag">{{ note.get_category_display }}</span>
                    <form method="post" action="{% url 'delete_note' note.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn-text">Delete</button>
                    </form>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p class="empty">Nenhuma nota criada.</p>
        {% endif %}
      <form id="note-form" class="hidden-form" method="post" action="{% url 'create_note' %}">
        {% csrf_token %}
        {{ note_form.as_p }}
        <button type="submit" class="submit-btn">Salvar nota</button>
      </form>
    </section>

  </main>

  <script>
    function toggleForm(id) {
      const form = document.getElementById(id);
      form.style.display = form.style.display === 'block' ? 'none' : 'block';
    }
  </script>
</body>
</html>
